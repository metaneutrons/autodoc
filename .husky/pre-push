#!/bin/sh

echo "ğŸ§ª Running tests before push..."

# Run all tests single-threaded to avoid race conditions
if ! cargo test --bin docpilot -- --test-threads=1; then
    echo "âŒ Tests failed. Fix failing tests before pushing."
    exit 1
fi

echo "ğŸ”’ Running security audit..."

# Run security audit (only fail on actual vulnerabilities, allow warnings)
if ! cargo audit; then
    echo "âŒ Security audit found vulnerabilities. Please review and fix security issues."
    echo "ğŸ’¡ You can run 'cargo audit' locally to see details."
    exit 1
fi

echo "âœ… All tests passed"
echo "âœ… Security audit passed"
echo "ğŸš€ Ready to push"
